
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // --- HELPER FUNCTIONS ---

    // Checks if the user is authenticated.
    function isAuthenticated() {
      return request.auth != null;
    }

    // Checks if the requesting user is the owner of a document.
    // Used for user-specific documents like their own profile.
    function isOwner(userId) {
      return isAuthenticated() && request.auth.uid == userId;
    }


    // --- BACKEND-ONLY ACCESS ---

    // By default, block all direct reads and writes from the client.
    // All data access should go through the backend (Firebase Functions).
    // This is the most secure approach.
    match /{path=**} {
      allow read, write: if false;
    }

    // --- CLIENT-ACCESSIBLE COLLECTIONS (Exceptions) ---

    // Publicly readable data (e.g., public templates, general info)
    // No public data in this app yet, but this is the pattern.
    // match /public_data/{docId} {
    //   allow read: if true;
    //   allow write: if false; // Should be written by backend/admin only
    // }

    // Allow users to read and write to their OWN client document only.
    // This is necessary for profile updates from the client-side.
    match /clients/{clientId} {
      allow read, write: if isOwner(clientId);
    }
    
    // Allow users to submit inquiries. This is a write-only entry point for anyone.
    match /inquiries/{inquiryId} {
      allow create: if true;
      allow read, update, delete: if false; // Readable only by backend/admin
    }

    // Allow anyone to subscribe to the newsletter.
    match /subscribers/{email} {
      allow create: if true;
      allow read, update, delete: if false; // Readable only by backend/admin
    }
  }
}
